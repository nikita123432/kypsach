<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css"  href="../static/css/register.css" th:href="@{/css/sex.css}">
</head>
<body>
<header>
    <nav>
        <a href="/products"><input type="button" value="Главная" style="font-size: 22px; "></a>
        <div class="search-box">
            <form >
                <input type="text" name="title" id="searchInput" placeholder="Поиск" onkeypress="handleKeyPress(event)" style="font-size: 24px; display: flex;">
                <button type="button" onclick="applySearch()" class="search-button"></button>
            </form>
        </div>

        <div class="main-menu">
            <a href="/logout" style=" margin-right: 20px; font-size: 22px" >Выйти</a>

                <div th:if="${#authorization.expression('hasRole(''ROLE_USER'')')}">
                    <a href="/basket"><img th:src="@{'/photos/карзина.png'}" width="30" height="30" style=""></a>
                </div>

        </div>
    </nav>
</header>



<img src="https://designlogo.com.ua/wp-content/uploads/2017/01/clothing_brand_corporate_Identity_.jpg" alt="Картинка под шапкой" style="width: 68%; height: 510px; margin-top: 10px">


    <form>
        <select id="categorySelect" name = "category" onchange="applyCategory()" required>
            <option value="default">Все</option>
            <option th:each="category : ${T(com.example.buysell.models.Category).values()}"
                    th:value="${category.name()}" th:text="${category.name()}"></option>
        </select>
    </form>


        <div class="products-container" th:each="product : ${products}">
            <a th:href="@{'/product?productId=' + ${product.id}}" class="product-card">
                <img th:src="@{'/photos/' + ${product.photoUrl.get(0)}}" alt="Product Image"/>
                <p class="title" th:text="${product.title}"></p>
                <p class="price"><span th:text="${product.price}"></span>$</p> <!-- Добавлено отображение цены -->
            </a>
        </div>

<!--    <footer>-->
<!--        <p>&copy; 2023 MaretСompany. Все права защищены.</p>-->
<!--        &lt;!&ndash; Здесь можете добавить дополнительную информацию, ссылки и т.д. &ndash;&gt;-->
<!--    </footer>-->


</body>
<script>
    function applySearch() {
        var searchInput = document.getElementById('searchInput').value.trim();

        // Кодируем введенное значение только один раз
        var encodedSearchInput = encodeURIComponent(searchInput);

        var url = new URL(window.location.href);
        url.searchParams.delete('title');

        if (searchInput) {
            url.searchParams.append('title', encodedSearchInput);
        }

        window.location.href = decodeURIComponent(url.toString());
    }


    document.addEventListener('DOMContentLoaded', function() {
        // Получаем текущий URL
        var url = new URL(window.location.href);

        // Получаем значение параметра "category" из URL
        var categoryParam = url.searchParams.get('category');

        // Если значение параметра "category" существует, устанавливаем его в select
        if (categoryParam !== null) {
            var categorySelect = document.getElementById('categorySelect');

            // Устанавливаем значение и обновляем select
            categorySelect.value = categoryParam;
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        // Получаем текущий URL
        var url = new URL(window.location.href);

        // Получаем значение параметра "category" из URL
        var titleParam = url.searchParams.get('title');

        // Если значение параметра "category" существует, устанавливаем его в select
        if (titleParam !== null) {
            var searchInput = document.getElementById('searchInput');

            // Устанавливаем значение и обновляем select
            searchInput.value = titleParam;
        }
    });

    function applyCategory() {
        var categorySelect = document.getElementById('categorySelect');
        var selectedCategory = categorySelect.value;

        // Получаем текущий URL
        var url = new URL(window.location.href);

        // Если выбрана категория, добавляем новое значение параметра "category" в URL
        if (selectedCategory !== 'default') {
            url.searchParams.set('category', selectedCategory);
        } else {
            // Если выбрана опция "Все", удаляем параметр "category" из URL
            url.searchParams.delete('category');
        }

        // Перенаправляем на обновленный URL
        window.location.href = url.toString();
    }



    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            applySearch();
            event.preventDefault(); // Предотвращаем стандартное поведение (например, отправку формы)
        }
    }
</script>

</html>